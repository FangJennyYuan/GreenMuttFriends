@using WebApplication1.Models;
@model List<TotalPhotosTakenModel>

<!doctype html>
<meta charset="utf-8">

<script src="//d3plus.org/js/d3.js"></script>
<script src="//d3plus.org/js/d3plus.js"></script>

@{
    ViewBag.Title = "Performance Dashboard";
}
@Scripts.Render("~/Scripts/jquery-3.4.1.js")
@Scripts.Render("~/Scripts/moment.js")
@Scripts.Render("~/Scripts/daterangepicker.js")
@Scripts.Render("~/Scripts/calendar.js")
@Scripts.Render("~/Scripts/photostakengraph.js")

<h1>
    Performance Dashboard
</h1>

<div class="row date-filter mt-3">
    <div class="col-lg-1">
        <button type="button" id="week" onclick="getWeeksDate()"> Week</button>
    </div>
    <div class="col-lg-1 mr-3">
        <button type="button" id="month" onclick="getMonthsDate()"> Month</button>
    </div>
    <div class="col-lg-1">
        <button type="button" id="all-date" onclick="getYearsDate()"> All</button>
    </div>
    <div class="col-lg-4">
        Date
        <input type="text" id="date-input" name="daterange" value="" />

    </div>
</div>

<div class="row clinic-filter mt-2">
    <div class="span3 ml-4 mr-2 filter-name">
        <span>Filter by:</span>
    </div>
    <div class="span2 mr-2">
        <img class="img-valign" src="~/Content/img/clinic_Ijowa.png" alt="Ijora" />
        <span class="primary-color">Ijora Clinic</span>
    </div>
    <div class="span2 mr-2">
        <img class="img-valign" src="~/Content/img/clinic_Katsina.png" alt="Katsina" />
        <span class="third-color">Katsina Clinic</span>
    </div>
    <div class="span2 mr-2">
        <img class="img-valign" src="~/Content/img/clinic_Mashegu.png" alt="Mashegu" />
        <span class="fourth-color">Mashegu Clinic</span>
    </div>
    <div class="span2 mr-2">
        <img class="img-valign" src="~/Content/img/clinic_Rawayau.png" alt="Rawayau" />
        <span class="secondary-color">Rawayau Clinic</span>
    </div>
</div>

<div class="row mt-3 performance-graphs">
    <div class="col-lg-7 ml-2">
        <div class="row">
            <div class="col">
                <h3> Photos Taken <span class="graph-filtered-by date"> from May 19th to May 25th </span></h3>
            </div>
            <div class="col-1">
                @{
                    var myAccountModel = WebApplication1.Backend.AccountBackend.Instance.GetActiveUser();
                    if (myAccountModel.isAccountLoggedIn)
                    {
                        <label for="id-of-input7" class="custom-checkbox favorite-graph">
                            <input type="checkbox" id="id-of-input7" class="favorites" />
                            <i class="fa fa-star fa-stack-1x favorited"></i>
                            <i class="fa fa-star-o fa-stack-1x not-favorited"></i>
                        </label>
                    }
                    else
                    {

                    }
                }
            </div>
        </div>
        <div id="photos_taken_chart"></div>
    </div>
    <div class="col">
        <div class="row">
            <div class="col">
                <h3> Avg Photos Taken <span class="graph-filtered-by"> by Device </span></h3>
            </div>
            <div class="col-1">
                @{
                    if (myAccountModel.isAccountLoggedIn)
                    {
                        <label for="id-of-input8" class="custom-checkbox favorite-graph">
                            <input type="checkbox" id="id-of-input8" class="favorites" />
                            <i class="fa fa-star fa-stack-1x favorited"></i>
                            <i class="fa fa-star-o fa-stack-1x not-favorited"></i>
                        </label>
                    }
                    else
                    {

                    }
                }
            </div>
        </div>
        <img class="img-fluid photos_taken" src="~/Content/img/AvgPhotosTakenByDevice_May19to25_All.png" />
        <p class="align-bottom ml-5 pl-4 text-center"> Avg # of Photos <span class="date"> from May 19th to May 25th</span></p>
    </div>
</div>



<script>

    //Pull Photos Data on Week
    $("#week").click(
        function () {
            currentPhotoData = getDatabyDate(moment().subtract(7, 'days'), moment());
            console.log(currentPhotoData);

            //Remove old graph
            $("#photos_taken_chart").empty();

            //Draw new Graph
            drawPhotosTakenGraph(currentPhotoData);
        }
    );

    //Pull Photos Data on Month
    $("#month").click(
        function () {
            currentPhotoData = getDatabyDate(moment().startOf('month'), moment());
            console.log(currentPhotoData);

            //Remove old graph
            $("#photos_taken_chart").empty();

            //Draw new Graph
            drawPhotosTakenGraph(currentPhotoData);
        }
    );
    //Default view
    $('#week').trigger('click');

    function getDatabyDate(start, end) {
            photosData = [
            @{
                foreach (var item in Model)
                {
                    var photosTakenAmp = 0;
                    //Just amplifying Ijora Clinic Results For Demo
                    if(item.Clinic == "Ijora Clinic")
                    {
                        photosTakenAmp = Convert.ToInt32(item.Value * 1.6);
                    }
                    else{
                        photosTakenAmp = item.Value;
                    }
                    var outputString = Html.Raw("{ clinic: \"" + item.Clinic + "\", Date: \"" + item.Date.ToShortDateString() + "\", value: " + photosTakenAmp + ", userCount: " + item.UserCount + " },");
                    @outputString
                }
            }
            ],
            start = start,
            end = end,
            currentPhotoData = photosData.filter(d => {
                var date = new moment(d.Date);
                return (start <= date && date <= end);
            });
        return currentPhotoData;
    };

    
</script>